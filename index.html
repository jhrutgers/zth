<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zth (libzth): Zth (libzth)</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Zth (libzth)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('index.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Zth (libzth) </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a> <a href="https://github.com/jhrutgers/zth/actions?query=workflow%3ACI"><img src="https://github.com/jhrutgers/zth/workflows/CI/badge.svg" alt="CI" style="pointer-events: none;" class="inline"/></a></p>
<h1>Zth (libzth) - Zeta threads</h1>
<p>This library provides user-space cooperative multitasking, also known as fibers. One can see fibers as threads, but with the exception that you explicitly have to indicate when the fiber is allowed to switch to another fiber. As a result, locking, synchronization, using shared data structures between fibers is way easier than when using threads. See also <a href="https://en.wikipedia.org/wiki/Fiber_(computer_science)">https://en.wikipedia.org/wiki/Fiber_(computer_science)</a>.</p>
<p>The main benefits of Zth are:</p>
<ul>
<li>Cross-platform (Linux/Windows/macOS/bare metal) library for cross-platform application development.</li>
<li>No dependencies, other than a C library (usually <a href="https://sourceware.org/newlib/">newlib</a> for embedded targets), and <code>clock_gettime()</code>. When available, <a href="https://zeromq.org/">ZeroMQ</a> is supported and made fiber-aware, which can be used for inter-thread or inter-process communication.</li>
<li>The configuration can be tailored towards your target, such as fiber stack size, time slices, debug/VCD output.</li>
<li>Usage of dynamic memory is minimized (only during fiber creation and cleanup), and it allocator-aware.</li>
<li>Support for <a href="https://github.com/google/sanitizers">ASan, LSan, UBSan</a>, and <a href="https://valgrind.org/">Valgrind</a>.</li>
</ul>
<p>Working with fibers is very easy. The <code>examples/1_helloworld</code> example starts two fibers by using <code><a class="el" href="group__zth__api__cpp__fiber.html#ga726ffb960e201a580e3ee6c82bf3a5e1" title="Create and start a new fiber.">zth::fiber()</a></code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;<a class="code" href="zth.html">zth</a>&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;cstdio&gt;</span></div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> world()</div>
<div class="line">{</div>
<div class="line">        printf(<span class="stringliteral">&quot;Wonderful\n&quot;</span>);</div>
<div class="line">        <a class="code hl_function" href="group__zth__api__cpp__fiber.html#ga727bc20a95cfe9f95c19a5c0367a77dc">zth::yield</a>();</div>
<div class="line">        printf(<span class="stringliteral">&quot;World!!1\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> hello()</div>
<div class="line">{</div>
<div class="line">        <a class="code hl_function" href="group__zth__api__cpp__fiber.html#ga726ffb960e201a580e3ee6c82bf3a5e1">zth::fiber</a>(world);</div>
<div class="line">        printf(<span class="stringliteral">&quot;Hello\n&quot;</span>);</div>
<div class="line">}</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">int</span> <a class="code hl_function" href="fiber_8h.html#ac8d3574f284314abb573cdb5762eaf94">main_fiber</a>(<span class="keywordtype">int</span> argc, <span class="keywordtype">char</span>** argv)</div>
<div class="line">{</div>
<div class="line">        <a class="code hl_function" href="group__zth__api__cpp__fiber.html#ga726ffb960e201a580e3ee6c82bf3a5e1">zth::fiber</a>(hello);</div>
<div class="line">        <span class="keywordflow">return</span> 0;</div>
<div class="line">}</div>
<div class="ttc" id="afiber_8h_html_ac8d3574f284314abb573cdb5762eaf94"><div class="ttname"><a href="fiber_8h.html#ac8d3574f284314abb573cdb5762eaf94">main_fiber</a></div><div class="ttdeci">int main_fiber(int argc, char **argv)</div><div class="ttdef"><b>Definition</b> <a href="main_8cpp_source.html#l00011">main.cpp:11</a></div></div>
<div class="ttc" id="agroup__zth__api__cpp__fiber_html_ga726ffb960e201a580e3ee6c82bf3a5e1"><div class="ttname"><a href="group__zth__api__cpp__fiber.html#ga726ffb960e201a580e3ee6c82bf3a5e1">zth::fiber</a></div><div class="ttdeci">fiber_type&lt; F &gt;::fiber fiber(F &amp;&amp;f, Args &amp;&amp;... args)</div><div class="ttdoc">Create and start a new fiber.</div><div class="ttdef"><b>Definition</b> <a href="async_8h_source.html#l01192">async.h:1192</a></div></div>
<div class="ttc" id="agroup__zth__api__cpp__fiber_html_ga727bc20a95cfe9f95c19a5c0367a77dc"><div class="ttname"><a href="group__zth__api__cpp__fiber.html#ga727bc20a95cfe9f95c19a5c0367a77dc">zth::yield</a></div><div class="ttdeci">void yield(Fiber *preferFiber=nullptr, bool alwaysYield=false, Timestamp const &amp;now=Timestamp::now())</div><div class="ttdoc">Allow a context switch.</div><div class="ttdef"><b>Definition</b> <a href="worker_8h_source.html#l00454">worker.h:454</a></div></div>
<div class="ttc" id="azth_html"><div class="ttname"><a href="zth.html">zth</a></div></div>
</div><!-- fragment --><p>Notable other features include:</p>
<ul>
<li>C++20 Coroutine support, to run, share, and <code>co_await</code> a coro between fibers.</li>
<li>ARM support with automatic MPU configuration to check stack overflows.</li>
<li>Finite State Machine implementation, which allows defining state transitions in an eDSL, and easily transforms into a fiber-aware FSM, properly handling polling timed guards.</li>
<li>Extensible Poller framework, which allows <code>poll()</code>-like calls by fibers to be forwarded to a single poller server, which can be user-defined for custom pollable types.</li>
<li>Inter-fiber signaling, such as a mutex, semaphore, signal, and future.</li>
</ul>
<p>Check out the <a href="https://jhrutgers.github.io/zth/examples.html">examples</a> for more details, including the full explanation of the example above.</p>
<p>Supported platforms are:</p>
<ul>
<li>Ubuntu/macOS/Windows 32/64-bit</li>
<li>bare-metal 32-bit ARM (with newlib)</li>
<li>gcc 4 or newer</li>
<li>C++98 or newer, C99 or newer. However, compiling for later C++ standards adds features and improves performance.</li>
</ul>
<p>Check out the <code>dist</code> directory for example targets.</p>
<h2>How to build</h2>
<p>To install all build dependencies, run <code>dist/&lt;platform&gt;/bootstrap</code> (as Administrator under Windows). Next, run <code>dist/&lt;platform&gt;/build</code> to build the library and all examples. By default, release builds are generated. To do debug builds, pass <code>Debug</code> as command line argument to <code>dist/&lt;platform&gt;/build</code>. VS Code configuration is available too.</p>
<p>After building, check out the <code>doxygen/html</code> directory for <a href="https://jhrutgers.github.io/zth">documentation</a>.</p>
<h3>How to integrate in your project</h3>
<p>Configure Zth options as required, like this:</p>
<div class="fragment"><div class="line">set(ZTH_THREADS OFF CACHE BOOL &quot;Disable threads&quot; FORCE)</div>
<div class="line"> </div>
<div class="line"># Override search path to your own zth_config.h.</div>
<div class="line">target_include_directories(libzth BEFORE PUBLIC ${CMAKE_SOURCE_DIR}/include)</div>
</div><!-- fragment --><p>See <code>cmake/zth.cmake</code> for the available options. Next, add libzth's <code>cmake</code> directory to your <code>CMAKE_MODULE_PATH</code> and <code>include(zth)</code>. Then, just link to <code>libzth</code>.</p>
<p>This also works for cross-compiling. Refer to <code><a class="el" href="_r_e_a_d_m_e-_a_r_m_8md.html">dist/qemu-arm-a15/README-ARM.md</a></code> for some hints when compiling for bare-metal ARM.</p>
<p>Note that <code><a class="el" href="zth__config_8h.html">zth_config.h</a></code> can be provided by the user to optimize the configuration for a specific target. However, its include path must be available while compiling libzth itself. After installing the library, the configuration cannot be changed.</p>
<h2>How to run</h2>
<p>Zth checks for environment variables, which are listed below. The environment is (usually) only checked once, so dynamically changing the variables after startup has no effect to Zth's behavior.</p>
<ul>
<li><code>ZTH_CONFIG_ENABLE_DEBUG_PRINT</code> <br  />
 When set to 1, debug prints are enabled. Disabled by default. For non-debug builds, all debug prints are removed from the binary, so they cannot be enabled in that case.</li>
<li><code>ZTH_CONFIG_DO_PERF_EVENT</code> <br  />
 When set to 1, perf VCD file generation is enabled. Disabled by default.</li>
<li><code>ZTH_CONFIG_DO_PERF_SYSCALL</code> <br  />
 When set to 1, the perf VCD logs will contain all calls to Zth's special functions. Enabled by default.</li>
<li><code>ZTH_CONFIG_CHECK_TIMESLICE_OVERRUN</code> When set to 1, check at every context switch if the timeslice was overrun significantly. Only the longest overrun is reported. Enabled by default in the debug build, not available in release builds.</li>
</ul>
<h2>Related</h2>
<p>A predecessor project was called Xi, as the Greek capital symbol suggests parallel threads. In this project, preemptive multitasking is implemented. In the same context, the Z(eta) symbol suggests that threads are not parallel, but they explicitly yield from one to another.</p>
<p><a href="https://www.gnu.org/software/pth/">GNU Pth</a> has been a great inspiration for this library.</p>
<h2>License</h2>
<p>(Most of) this project is licensed under the terms of the Mozilla Public License, v. 2.0, as specified in LICENSE. This project complies to <a href="https://reuse.software/">REUSE</a>. </p>
</div></div><!-- PageDoc -->
</div><!-- contents -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
