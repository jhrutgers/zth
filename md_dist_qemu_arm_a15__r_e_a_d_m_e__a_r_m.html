<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Zth (libzth): Using Zth on Bare-Metal ARM</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">Zth (libzth)
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(document).ready(function(){initNavTree('md_dist_qemu_arm_a15__r_e_a_d_m_e__a_r_m.html',''); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div class="PageDoc"><div class="header">
  <div class="headertitle">
<div class="title">Using Zth on Bare-Metal ARM </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>There is support for bare-metal ARM with Zth. Most of Zth's source code is just C++, so usable on any target. Only the context switching and hardware-related stuff like <code>clock_gettime()</code> is to be ported.</p>
<p>The directory <code>dist/qemu-arm-a15</code> contains a set of files that shows how to do this. It targets a QEMU virt machine to run the examples, and can be built on Ubuntu. This virt machine uses an ARM Cortex-A15 with VFP (without NEON). The implementation is not very sophisticated, but shows you where to start, if you have your own ARM system. The compiler, linker script, and startup files are probably supplied to you by the manufacturer of your board.</p>
<p>To get the stuff running, do this:</p>
<ol type="1">
<li>Run <code>bootstrap.sh</code>.</li>
<li>Run <code>build.sh</code>. Optionally, provide the <code>CMAKE_BUILD_TYPE</code> as first command line argument. It will use <code>arm-none-eabi-g++</code> to cross-compile the Zth library and examples. Additionally, a BSP library is built, using <code>crt0.c</code> and <code>startup.S</code>. These files include the interrupt vector for the ARM, initialization of the VFP, C/C++-runtime boot code, and the system calls that <code>newlib</code> needs, like <code>_read()</code> and <code>_write()</code>.</li>
<li>Run QEMU with one of the examples. (Note: Press 'Ctrl-A X' to terminate QEMU) <pre class="fragment">         qemu-system-arm -machine virt -cpu cortex-a15 -s -m 8M -nographic -kernel build/deploy/bin/1_helloworld
</pre> ...or simplified: <pre class="fragment">         ./run.sh build/deploy/bin/1_helloworld
</pre> If you have a Debug build, the output will include the banner, saying something like: <pre class="fragment">         &gt; zth::banner: Zth 1.0.0-rc g++-6.3.1 C++14 baremetal newlib2.4.0 armAv7 debug sjlj
</pre> Note that there is no OS that supplies <code><a class="el" href="group__zth__api__cpp__poller.html#ga043bfb5a7c98cdceb7c9386837ca466d" title="Fiber-aware poll() for a single pollable thing.">poll()</a></code>. So reading stdin is a bit tricky and not all examples behave the same way as at your PC. Moreover, 0MQ isn't available either, of course.</li>
<li>Connect <code>gdb</code> to QEMU. If you supply the <code>-S</code> argument to QEMU (or via <code>run.sh</code>), it waits for <code>gdb</code> to connect before it starts. That might make debugging a bit easier. <pre class="fragment">         gdb-multiarch -ex 'target remote :1234' -ex 'break main' -ex 'layout split' build/deploy/bin/1_helloworld
</pre> </li>
</ol>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1 </li>
  </ul>
</div>
</body>
</html>
